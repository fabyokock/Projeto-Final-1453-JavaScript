<!DOCTYPE html>

<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Boletim Final - Projeto JavaScript</title>
    <style>
      /* Estilos básicos para o corpo da página */
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        color: #333;
        margin: 40px auto;
        padding: 20px;
        max-width: 600px;
        line-height: 1.6;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* Estilo para o título principal */
      h1 {
        color: #0056b3;
        text-align: center;
        margin-top: 0;
      }

      /* Estilo para a linha divisória */
      hr {
        border-color: #0056b3;
      }

      /* Estilo para o texto em negrito */
      strong {
        color: #003366;
      }

      /* Estilo para os contêineres de conteúdo */
      #boletim-container {
        padding: 15px;
        background-color: #fff;
        border-radius: 5px;
      }

      #status-final {
        font-size: 1.2em;
        text-align: center;
        margin-top: 20px;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <h1>Boletim Final</h1>
    <hr />

    <div id="boletim-container">
      <p id="nome-aluno"></p>
      <div id="detalhes-notas"></div>
      <p id="calculo-media"></p>
      <p id="media-final"></p>
      <p id="status-final"></p>
    </div>

    <script>
      // MELHORIA #1: O código foi organizado em funções para facilitar a leitura e a manutenção.

      function solicitarDados() {
        // MELHORIA #2: Adicionada validação para garantir que o nome não seja vazio.
        let nome;
        do {
          nome = String(window.prompt("Digite o seu nome: "));
        } while (nome === "" || nome === "null");

        // MELHORIA #3: As notas e pesos agora são armazenados em um array de objetos.
        const notas = [];

        for (let i = 1; i <= 3; i++) {
          let nota;
          // MELHORIA #2: Adicionada validação para garantir que o usuário digite um número válido.
          do {
            nota = Number(window.prompt(`Olá, ${nome}, digite a nota ${i}: `));
          } while (isNaN(nota));

          // Cada nota é adicionada como um objeto com a nota e o peso correspondente.
          // O peso é definido pelo índice (1, 2, 3...)
          notas.push({ nota: nota, peso: i });
        }

        return { nome: nome, notas: notas };
      }

      function calcularMedia(notas) {
        // MELHORIA #4: Calculando a soma total das notas e a soma total dos pesos.
        let somaNotasComPeso = 0;
        let somaPesos = 0;

        // MELHORIA #3: Usando um laço de repetição (for) para somar as notas e os pesos do array.
        for (let i = 0; i < notas.length; i++) {
          somaNotasComPeso += notas[i].nota * notas[i].peso;
          somaPesos += notas[i].peso;
        }

        const mediaFinal = somaNotasComPeso / somaPesos;

        return {
          mediaFinal: mediaFinal,
          somaNotasComPeso: somaNotasComPeso,
          somaPesos: somaPesos,
        };
      }

      // MELHORIA #5: A função agora manipula o DOM, em vez de usar 'document.write'.
      function exibirBoletim(nome, notas, resultadoCalculo) {
        const { mediaFinal, somaNotasComPeso, somaPesos } = resultadoCalculo;

        window.alert(
          `${nome}, clique em "ok" para acessar o seu boletim final.`
        );

        // Referenciando os elementos HTML pelos seus IDs
        const nomeElemento = document.getElementById("nome-aluno");
        const detalhesNotasElemento = document.getElementById("detalhes-notas");
        const calculoMediaElemento = document.getElementById("calculo-media");
        const mediaFinalElemento = document.getElementById("media-final");
        const statusFinalElemento = document.getElementById("status-final");

        // Preenchendo os elementos HTML com o conteúdo gerado
        nomeElemento.innerHTML = `<strong>${nome}</strong>, <br>`;

        let detalhesNotasHTML = "";
        for (let i = 0; i < notas.length; i++) {
          const notaComPeso = notas[i].nota * notas[i].peso;
          detalhesNotasHTML += `A sua nota ${i + 1} foi ${
            notas[i].nota
          }, com o peso ${notas[i].peso} ficou: ${notaComPeso}. <br>`;
        }
        detalhesNotasElemento.innerHTML = detalhesNotasHTML;

        // MELHORIA #4: Exibindo informações adicionais para um relatório mais detalhado.
        calculoMediaElemento.innerHTML = `
          <br>
          O cálculo da sua média foi feito da seguinte forma: <br>
          <strong>Soma das notas com peso</strong>: ${somaNotasComPeso}. <br>
          <strong>Soma total dos pesos</strong>: ${somaPesos}. <br>
          <br>
        `;

        mediaFinalElemento.innerHTML = `Sendo assim, a sua média final foi: <strong>${mediaFinal.toFixed(
          2
        )}</strong>. <br>`;

        if (mediaFinal >= 7) {
          statusFinalElemento.innerHTML = `Você está <strong>APROVADO</strong>.`;
        } else if (mediaFinal >= 5) {
          statusFinalElemento.innerHTML = `Você precisará fazer <strong>PROVA FINAL</strong>.`;
        } else {
          statusFinalElemento.innerHTML = `Você está <strong>REPROVADO</strong>.`;
        }
      }

      // Inicia a execução do programa chamando as funções na ordem correta.
      const dadosDoAluno = solicitarDados();
      const resultadoCalculo = calcularMedia(dadosDoAluno.notas);
      exibirBoletim(dadosDoAluno.nome, dadosDoAluno.notas, resultadoCalculo);
    </script>
  </body>
</html>
