<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Boletim</title>
    <link rel="stylesheet" href="styleC2.css" />
  </head>
  <body>
    <h1>SISTEMA DE BOLETIM</h1>

    <hr />

    <div id="nomeDaTurma"></div>

    <hr />

    <h3>Boletim Geral</h3>

    <div id="tabelaGeral"></div>

    <hr />

    <div id="relatorio"></div>

    <script>
      let turma = [];

      let nomeDaTurma = window.prompt(`Digite o nome da turma:`);

      document.getElementById(
        `nomeDaTurma`
      ).innerHTML = `<h2>Nome da Turma: ${nomeDaTurma}</h2>`;

      let continuar = true; // Usado no switch/case

      // ----------------------------------------------------------------------
      // FUNÇÕES DO SISTEMA
      // ----------------------------------------------------------------------

      // ----------------------------------------------------------------------
      // Adicionar Aluno
      // ----------------------------------------------------------------------

      function adicionarAluno() {
        const nome = window.prompt(`Digite o nome do aluno:`);
        const notas = [];
        for (let i = 1; i <= 3; i++) {
          const nota = Number(window.prompt(`Digite a nota ${i} de ${nome}:`));
          notas.push({ nota: nota, peso: i });
        }
        const novoAluno = { nome: nome, notas: notas };

        turma.push(novoAluno);

        window.alert(`O aluno ${nome} foi adicionado com sucesso!`);

        exibirTabelaGeral();
      }

      // ----------------------------------------------------------------------
      // Alterar Aluno
      // ----------------------------------------------------------------------
      function alterarAluno() {
        const nomeParaAlterar = window.prompt(
          `Digite o nome do aluno para alterar:`
        );
        turma = turma.map((aluno) => {
          if (
            aluno.nome.toLocaleLowerCase() ===
            nomeParaAlterar.toLocaleLowerCase()
          ) {
            const novaNota1 = Number(
              window.prompt(`Digite a nova nota 1 de ${aluno.nome}:`)
            );
            const novaNota2 = Number(
              window.prompt(`Digite a nova nota 2 de ${aluno.nome}:`)
            );
            const novaNota3 = Number(
              window.prompt(`Digite a nova nota 3 de ${aluno.nome}:`)
            );

            aluno.notas[0].nota = novaNota1;
            aluno.notas[1].nota = novaNota2;
            aluno.notas[2].nota = novaNota3;

            window.alert(
              `Os dados de ${aluno.nome} foram alterados com sucesso!`
            );
          } else {
            window.alert(`Aluno ${nomeParaAlterar} não encontrado.`);
          }
          return aluno;
        });

        exibirTabelaGeral();
      }

      // ----------------------------------------------------------------------
      // Excluir Aluno
      // ----------------------------------------------------------------------

      function excluirAluno() {
        const nomeParaExcluir = window.prompt(
          `Digite o nome do aluno para excluir:`
        );

        const tamanhoAntes = turma.length;

        turma = turma.filter(
          (aluno) =>
            aluno.nome.toLowerCase() !== nomeParaExcluir.toLocaleLowerCase()
        );

        if (turma.length < tamanhoAntes) {
          window.alert(`O aluno ${nomeParaExcluir} foi excluído com sucesso!`);
        } else {
          window.alert(`Aluno ${nomeParaExcluir} não encontrado.`);
        }

        exibirTabelaGeral();
      }

      // ----------------------------------------------------------------------
      // Exibir Tabela Geral
      // ----------------------------------------------------------------------
      function exibirTabelaGeral() {
        let tabelaHTML = `
            <table border="1">
              <thead>
                <tr>
                  <th>NOME</th>
                  <th>NOTA 1</th>
                  <th>NOTA 2</th>
                  <th>NOTA 3</th>
                  <th>MÉDIA</th>
                  <th>STATUS</th>
                </tr>
              </thead>
              <tbody>
          `;

        turma.forEach((aluno) => {
          let somaNotasComPeso = 0;
          let somaPesos = 0;

          aluno.notas.forEach((nota) => {
            somaNotasComPeso = somaNotasComPeso + nota.nota * nota.peso;
            somaPesos = somaPesos + nota.peso;
          });

          const mediaFinal = somaNotasComPeso / somaPesos;
          const status =
            mediaFinal >= 7
              ? `APROVADO`
              : mediaFinal >= 5
              ? `EM PROVA FINAL`
              : `REPROVADO`;

          tabelaHTML =
            tabelaHTML +
            `
              <tr>
                <td>${aluno.nome}</td>
                <td>${aluno.notas[0].nota}</td>
                <td>${aluno.notas[1].nota}</td>
                <td>${aluno.notas[2].nota}</td>
                <td>${mediaFinal.toFixed(2)}</td>
                <td>${status}</td>
              </tr>
            `;
        });

        tabelaHTML =
          tabelaHTML +
          `
              </tbody>
            </table>
          `;

        document.getElementById(`tabelaGeral`).innerHTML = tabelaHTML;
      }

      // ----------------------------------------------------------------------
      // Exibir o Relatório
      // ----------------------------------------------------------------------
      function exibirRelatorio() {
        let relatorio = `<h3>Relatório Detalhado por Aluno:</h3>`;

        turma.forEach((aluno) => {
          let somaNotasComPeso = 0;
          let somaPesos = 0;

          aluno.notas.forEach((nota) => {
            somaNotasComPeso = somaNotasComPeso + nota.nota * nota.peso;
            somaPesos = somaPesos + nota.peso;
          });

          const mediaFinal = somaNotasComPeso / somaPesos;
          const status =
            mediaFinal >= 7
              ? `APROVADO`
              : mediaFinal >= 5
              ? `EM PROVA FINAL`
              : `REPROVADO`;

          relatorio =
            relatorio +
            `
<div class="card">
          <h4>${aluno.nome}</h4>
          <p>A primeira nota foi ${aluno.notas[0].nota}, com o peso ${
              aluno.notas[0].peso
            } ficou: ${aluno.notas[0].nota * aluno.notas[0].peso}.</p>
          <p>A segunda nota foi ${aluno.notas[1].nota}, com o peso ${
              aluno.notas[1].peso
            } ficou: ${aluno.notas[1].nota * aluno.notas[1].peso}.</p>
          <p>A terceira nota foi ${aluno.notas[2].nota}, com o peso ${
              aluno.notas[2].peso
            } ficou: ${aluno.notas[2].nota * aluno.notas[2].peso}.</p>
          <p><strong>Soma das notas com peso:</strong> ${somaNotasComPeso}</p>
          <p><strong>Soma total dos pesos:</strong> ${somaPesos}</p>
          <p><strong>Média final:</strong> ${mediaFinal.toFixed(2)}</p>
          <p>Status: <strong>${status}</strong></p>
        </div>`;
        });
        document.getElementById(`relatorio`).innerHTML = relatorio;
      }

      // ----------------------------------------------------------------------
      // LÓGICA INICIAL DO SISTEMA
      // ----------------------------------------------------------------------

      while (continuar) {
        const opcao = window.prompt(
          `Escolha uma opção: \n\n` +
            `1 - Adicionar novo aluno \n` +
            `2 - Alterar dados de um aluno \n` +
            `3 - Excluir um aluno \n` +
            `4 - Gerar relatório detalhado \n` +
            `5 - Sair`
        );
        switch (opcao) {
          case `1`:
            adicionarAluno();
            break;
          case `2`:
            alterarAluno();
            break;
          case `3`:
            excluirAluno();
            break;
          case `4`:
            exibirRelatorio();
            break;
          case `5`:
            continuar = false;
            window.alert(
              `Obrigado por utilizar o sistema. O programa será encerrado.`
            );
            break;
          default:
            window.alert(`Opção inválida. Tente novamente.`);
            break;
        }
      }
    </script>
  </body>
</html>
