<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Boletim</title>
  </head>
  <body>
    <h1>SISTEMA DE BOLETIM</h1>
    <hr />
    <div id="nomeDaTurma"></div>
    <hr />
    <h3>Boletim Geral</h3>
    <hr />
    <h3>Relatório Detalhado por Aluno</h3>
    <div id="relatorio"></div>

    <script>
      const turma = [];

      const nomeDaTurma = window.prompt(`Digite o nome da turma:`);

      document.getElementById(
        `nomeDaTurma`
      ).innerHTML = `<h2>Nome da Turma: ${nomeDaTurma}</h2>`;

      let continuar = true;

      // ----------------------------------------------------------------------
      // FUNÇÕES DO SISTEMA
      // ----------------------------------------------------------------------

      // ----------------------------------------------------------------------
      // Adicionar Aluno
      // ----------------------------------------------------------------------

      function adicionarAluno() {
        const nome = window.prompt(`Digite o nome do aluno:`);
        const notas = [];
        for (let i = 1; i <= 3; i++) {
          const nota = Number(window.prompt(`Digite a nota ${i} de ${nome}:`));
          notas.push({ nota: nota, peso: i });
        }
        const novoAluno = { nome: nome, notas: notas };

        turma.push(novoAluno);

        window.alert(`O aluno ${nome} foi adicionado com sucesso!`);
      }

      // ----------------------------------------------------------------------
      // Alterar Aluno
      // ----------------------------------------------------------------------
      function alterarAluno() {
        const nomeParaAlterar = window.prompt(
          `Digite o nome do aluno para alterar:`
        );
        turma.map;
        (aluno) => {
          if (aluno.nome === nomeParaAlterar) {
            const novaNota1 = Number(
              window.prompt(`Digite a nova nota 1 de ${aluno.nome}:`)
            );
            const novaNota2 = Number(
              window.prompt(`Digite a nova nota 2 de ${aluno.nome}:`)
            );
            const novaNota3 = Number(
              window.prompt(`Digite a nova nota 3 de ${aluno.nome}:`)
            );

            aluno.notas[0].nota = novaNota1;
            aluno.notas[1].nota = novaNota2;
            aluno.notas[2].nota = novaNota3;

            window.alert(
              `Os dados de ${aluno.nome} foram alterados com sucesso!`
            );
          }
          return aluno;
        };
      }

      // ----------------------------------------------------------------------
      // Excluir Aluno
      // ----------------------------------------------------------------------

      function excluirAluno() {
        const nomeParaExcluir = window.prompt(
          `Digite o nome do aluno para excluir:`
        );
        turma = turma.filter((aluno) => aluno.nome !== nomeParaExcluir);
        window.alert(`O aluno ${nomeParaExcluir} foi excluído com sucesso!`);
      }

      // ----------------------------------------------------------------------
      // Exibir o Relatório
      // ----------------------------------------------------------------------
      function exibirRelatorio() {
        //  let relatorio = `<h2>Relatório da Turma: ${nomeDaTurma}</h2>`;

        let relatorio;

        turma.forEach((aluno) => {
          const notas = aluno.notas;
          let somaNotasComPeso = 0;
          let somaPesos = 0;

          notas.forEach((nota) => {
            somaNotasComPeso = somaNotasComPeso + nota.nota * nota.peso;
            somaPesos = somaPesos + nota.peso;
          });

          const mediaFinal = somaNotasComPeso / somaPesos;
          const status =
            mediaFinal >= 7
              ? `APROVADO`
              : mediaFinal >= 5
              ? `de PROVA FINAL`
              : `REPROVADO`;

          relatorio = `<hr>
                 <h3>Aluno: ${aluno.nome}</h3>
                 <p>A nota 1 foi ${notas[0].nota}, com o peso ${
            notas[0].peso
          } ficou: ${notas[0].nota * notas[0].peso}.</p>
                 <p>A nota 2 foi ${notas[1].nota}, com o peso ${
            notas[1].peso
          } ficou: ${notas[1].nota * notas[1].peso}.</p>
                 <p>A nota 3 foi ${notas[2].nota}, com o peso ${
            notas[2].peso
          } ficou ${notas[2].nota * notas[2].peso}.</p>
                 <p>O cálculo da média foi feito da seguinte forma:</p>
                 <ul>
                 <li><strong>Soma das notas com peso</strong>: ${somaNotasComPeso}</li>
                 <li><strong>Soma total dos pesos</strong>: ${somaPesos}</li>
                 </ul>
                 <p>Sendo assim, a média final foi: ${mediaFinal.toFixed(2)}</p>
                 <p>O aluno <strong>${
                   aluno.nome
                 }</strong> está <strong>${status}</strong></p>
                 `;
        });
        document.getElementById(`relatorio`).innerHTML = relatorio;
      }

      // ----------------------------------------------------------------------
      // LÓGICA INICIAL DO SISTEMA
      // ----------------------------------------------------------------------

      while (continuar) {
        const opcao = window.prompt(
          `Escolha uma opção: \n\n` +
            `1 - Adicionar novo aluno \n` +
            `2 - Alterar dados de um aluno \n` +
            `3 - Excluir um aluno \n` +
            `4 - Gerar relatório detalhado \n` +
            `5 - Sair`
        );
        switch (opcao) {
          case `1`:
            adicionarAluno();
            break;
          case `2`:
            alterarAluno();
            break;
          case `3`:
            excluirAluno();
            break;
          case `4`:
            exibirRelatorio();
            break;
          case `5`:
            continuar = false;
            window.alert(
              `Obrigado por utilizar o sistema. O programa será encerrado.`
            );
            break;
          default:
            window.alert(`Opção inválida. Tente novamente.`);
            break;
        }
      }
    </script>
  </body>
</html>
